
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notifications</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/item_page.css">
   
    <link href="/css/notify.css" rel="stylesheet">
    <link href="/css/login.css" rel="stylesheet">
    <link href="/css/footer.css" rel="stylesheet">
    <link href="/css/header.css" rel="stylesheet">
     <!-- <link href="/css/styles.css" rel="stylesheet"> -->
</head>
<body>
      <%- include("header") %>

    <div class="container mt-5 mb-5">
        <div class="d-flex justify-content-center row mt-5">
            <div class="col-md-10 mt-3">
                <% if (notifications && notifications.length > 0) { %>
                    <% notifications.forEach(notification => { %>
                        <div class="row bg-white border rounded p-3 mb-3 shadow-sm product-container">
                            <div class="col-md-3 d-flex align-items-center justify-content-center mb-2 mb-md-0">
                                <img src="<%= notification.imageUrl %>" alt="<%= notification.name %>" class="img-fluid rounded product-image" style="max-height: 200px; object-fit: contain;">
                            </div>
                            <div class="col-md-6 mt-2 d-flex flex-column justify-content-between">
                                <h5 class="fw-bold mb-4 text-truncate" style="font-size: 1.2rem;"><%= notification.name %></h5>
                                <div class="product-detail mb-3">
                                    <h6 class="mb-0" style="font-size: 1rem; font-weight: 600;">Product Details:</h6>
                                    <p style="font-size: 0.9rem; color: #555;"><%= notification.details %></p>
                                </div>
                                <div class="d-flex flex-column mb-3">
                                    <div class="d-flex align-items-center mb-2">
                                        <h6 class="mb-0" style="font-size: 1rem; font-weight: 600;">Rent Per Day:</h6>
                                        <p class="mb-0 ms-2" style="font-size: 0.9rem; color: #333;">Rs.<%= notification.pricePerDay %></p>
                                    </div>
                                    <div class="d-flex align-items-center mb-2">
                                        <h6 class="mb-0" style="font-size: 1rem; font-weight: 600;">Renting Dates:</h6>
                                        <p class="mb-0 ms-2" style="font-size: 0.9rem; color: #555;"><%= notification.rentedStartDate %> To: <%= notification.rentedEndDate %></p>
                                    </div>
                                    <% if (notification.type === 'request') { %> 
                                    <div class="d-flex align-items-center">
                                        <h6 class="mb-0" style="font-size: 1rem; font-weight: 600;">Requested By:</h6>
                                        <p class="mb-0 ms-2" style="font-size: 0.9rem; color: #555;"><%= notification.requestedBy %></p>
                                    </div>
                                    <% } else if (notification.type === 'response') { %>
                                        <div class="d-flex align-items-center">
                                            <h6 class="mb-0" style="font-size: 1rem; font-weight: 600;">Rented By:</h6>
                                            <p class="mb-0 ms-2" style="font-size: 0.9rem; color: #555;"><%= notification.requestedBy %></p>
                                        </div>
                                        <% } %>
                                </div>
                            </div>
                            <div class="col-md-3 d-flex flex-column justify-content-center align-items-center text-center border-start">
                                <p class="text-primary fw-bold mb-3" style="font-size: 1rem;">Rs.<%= notification.totalAmount %></p>
                                <% if (notification.status === 'approved') { %>
                                    <% if (notification.type === 'request') { %>

                                    <p class="text-success fw-bold mb-2" id="requestApproved<%= notification._id %>" style="font-size: 1rem;">Request Approved</p>
                                    <div class="w-75">
                                        <button class="btn btn-info btn-sm w-100 viewDetailsButton" type="button" data-bs-toggle="modal" data-bs-target="#viewDetailsModal-<%= notification._id %>" style="font-size: 0.9rem;">
                                            View Details
                                        </button>
                                    </div>
                                    <% } else if (notification.type === 'response') { %>
                                        <p class="text-success fw-bold mb-2" id="requestApproved<%= notification._id %>" style="font-size: 1rem;">Request Accepted</p>
                                    <div class="w-75">
                                        <button class="btn btn-info btn-sm w-100 viewDetailsButton" type="button" data-bs-toggle="modal" data-bs-target="#viewDetailsModal-<%= notification._id %>" style="font-size: 0.9rem;">
                                            View Details
                                        </button>
                                    </div>
                                        <% } %>
                                <% } else if (notification.status === 'rejected') { %>
                                    <% if (notification.type === 'request') { %>
                                    <p class="text-danger fw-bold mb-2" id="requestDeclined<%= notification._id %>" style="font-size: 1rem;">Request Disapproved</p>
                                    <% } else if (notification.type === 'response') { %>
                                        <p class="text-danger fw-bold mb-2" id="requestDeclined<%= notification._id %>" style="font-size: 1rem;">Request Declined</p>
                                        <% } %>
                                <% } else { %>
                                    <div class="w-75 buttonSection" id="actionButtons<%= notification._id %>">
                                        <button class="btn btn-primary btn-sm w-100 mb-2 confirmButton" type="button" data-id="<%= notification._id %>" data-bs-toggle="modal" data-bs-target="#confirmModal1-<%= notification._id %>" style="font-size: 0.9rem;">
                                            Confirm
                                        </button>
                                        <button class="btn btn-danger btn-sm w-100 declineSureButton" type="button" data-id="<%= notification._id %>" data-bs-toggle="modal" data-bs-target="#declineModal-<%= notification._id %>" style="font-size: 0.9rem;">
                                            Decline
                                        </button>
                                    </div>
                                <% } %>
                            </div>
                        </div>
                                             <!-- Confirm Modal -->
                                             <div class="modal fade" id="confirmModal1-<%= notification._id %>" data-request-id="<%= notification.requestId %>"  data-product-id="<%= notification.productId %>" tabindex="-1" aria-labelledby="modalLabel1-<%= notification._id %>" aria-hidden="true">
                                                <div class="modal-dialog modal-dialog-centered">
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <h5 class="modal-title" id="modalLabel1-<%= notification._id %>">Are you sure you want to accept the request?</h5>
                                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                        </div>
                                                        <div class="modal-body py-3 text-center">
                                                            <h6 class="text-success fw-bold mb-1">
                                                                If you confirm, the request will be accepted for <span class="text-primary"><%= notification.name %></span>
                                                            </h6>
                                                        </div>
                                                        <div class="modal-footer justify-content-center py-2">
                                                            <button type="button" class="btn btn-primary w-50 confirmOkButton" data-id="<%= notification._id %>" data-bs-dismiss="modal">OK</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                    
                                            <!-- View Details Modal -->
                                            <div class="modal fade" id="viewDetailsModal-<%= notification._id %>" tabindex="-1" aria-labelledby="viewDetailsLabel" aria-hidden="true">
                                                <div class="modal-dialog modal-dialog-centered">
                                                    <div class="modal-content">
                                                        <% if (notification.type === 'request') { %>
                                                        <div class="modal-header">
                                                            <h5 class="modal-title" id="viewDetailsLabel">Borrower Details</h5>
                                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                        </div>
                                                        <% } else if (notification.type === 'response') { %>
                                                            <div class="modal-header">
                                                                <h5 class="modal-title" id="viewDetailsLabel">Renter Details</h5>
                                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                            </div>
                                                            <% } %>
                                                        <div class="modal-body">
                                                            <p><strong>Name:</strong> <%= notification.requestedBy %></p>
                                                            <p><strong>Contact:</strong> <%= notification.renterContact %></p>
                                                            <h6 class="fw-bold mb-2">Pickup Location:</h6>
                                                            <p>Academic Block-1 Back Entrance</p>
                                                            <% if (notification.type === 'request') { %>
                                                            <p><strong>Please contact the borrower for more details.</strong></p>
                                                            <% } else if (notification.type === 'response') { %>
                                                                <p><strong>Please contact the renter for more details.</strong></p>
                                                                <% } %>
                                                        </div>
                                                        <div class="modal-footer justify-content-center">
                                                            <button type="button" class="btn btn-primary w-50" data-bs-dismiss="modal">Close</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                    
                                            <!-- Decline Confirmation Modal -->
                                            <div class="modal fade" id="declineModal-<%= notification._id %>" data-request-id="<%= notification.requestId %>" tabindex="-1" aria-labelledby="declineModalLabel<%= notification._id %>" aria-hidden="true">
                                                <div class="modal-dialog modal-dialog-centered">
                                                    <div class="modal-content" >
                                                        <div class="modal-header">
                                                            <h5 class="modal-title" id="declineModalLabel<%= notification._id %>">Are you sure you want to decline the request?</h5>
                                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                        </div>
                                                        <div class="modal-body py-3 text-center">
                                                            <p>If you decline, the request will be rejected and cannot be undone.</p>
                                                        </div>
                                                        <div class="modal-footer justify-content-center py-2">
                                                            <button type="button" class="btn btn-danger w-50 modalSureButton" data-id="<%= notification._id %>"  data-bs-dismiss="modal">Sure</button>
                                                            <button type="button" class="btn btn-secondary w-50" id="cancelButton" data-bs-dismiss="modal">Cancel</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                    <% }) %>
                <% } else { %>
                    <p class="no-requests">No notifications found.</p>
                <% } %>
            </div>
        </div>
    </div>

  
  

 
<%- include("footer") %>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"></script>
    <script src="/js/notify.js"></script>
    
    <script src = "/js/modals.js"></script>
</body>
</html>
